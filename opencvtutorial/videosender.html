<!DOCTYPE html>
<html>
<head>
	<title>Hello</title>
</head>
<body>
  <canvas id="videoOutput"></canvas>
  <button onclick=stream()>Send</button>
</body>
<script>
  console.log(123);
  var w = 320, h = 240;
  var url = "ws://localhost:5000"
  var ws = new WebSocket(url);
  ws.onopen = function(){
	  console.log("Websocket is connected.");
  }
  ws.onmessage = function(msg){
	  console.log(msg.data);
  }

  var constraints = {audio: false, video: true};
  /*function successCallback(stream){
  	video.srcObject = stream;
  	video.play();
  }
  
  function errorCallback(error){
   	console.log(error);
  }
  navigator.mediaDevices.getUserMedia(constraints, successCallback, errorCallback);*/
	var canvas = document.getElementById("videoOutput");
  canvas.width = w;
  canvas.height = h;

  var ctx = canvas.getContext("2d");
  function processImage(){
        ctx.drawImage(0, 0, w, h);
        setTimeout(processImage, 1);
  }
  processImage();

  function stream(){
    setInterval(sendImage, 30);
  }

  function sendImage(){
    var rawData = canvas.toDataURL("image/jpeg", 0.5);
    ws.send(rawData);
  }

</script>
</html>